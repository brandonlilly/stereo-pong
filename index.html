<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pong</title>

</head>
<body>
  <canvas id="pong-canvas" style="border: 1px solid black; margin: 200px auto; display: block"></canvas>

  <script src="compiled/application.js"></script>

  <script>
    "use strict";

    var canvas = document.getElementById("pong-canvas");
    var ctx = canvas.getContext("2d");
    const width = 800;
    const height = 400;
    canvas.width = width;
    canvas.height = height;
    var game = new Pong(ctx, width, height);

    var colors = [
      [71, 113, 134],
      [110, 146, 161],
      [17, 60, 81],
      [3, 37, 54],
      [54, 130, 127],
    ];

    var canvasData = ctx.getImageData(0, 0, width, height);

    // That's how you define the value of a pixel //
    function drawPixel (x, y, r, g, b, a) {
        var index = (x + y * width) * 4;

        canvasData.data[index + 0] = r;
        canvasData.data[index + 1] = g;
        canvasData.data[index + 2] = b;
        canvasData.data[index + 3] = a;
    }

    function drawPixels(ctx, pixels, colors, width, height) {
      for (var y = 0; y < height; y++) {
        for (var x = 0; x < width; x++) {
          var color = colors[pixels[y * width + x]];
          drawPixel(x, y, color[0], color[1], color[2], 255);
        }
      }
      ctx.putImageData(canvasData, 0, 0);
    }



    var t = 0;

    var square = function(w, h, xPos, yPos) {
      return function(x, y) {
        return (x < xPos + w/2 && x > xPos - w/2 && y < yPos + h/2 && y > yPos - h/2);
      };
    }

    var circle = function(r, xPos, yPos) {
      var xPos = 350;
      var yPos = 180 + Math.cos(t * 0.1) * 100;
      return function(x, y) {
        return (Math.sqrt(Math.pow(x - xPos, 2) + Math.pow(y - yPos, 2)) < r);
      };
    }

    document.onkeydown = function(e) {
      switch (e.keyCode) {
        case 87:
          leftPaddle.y -= 20;
          break;
        case 83:
          leftPaddle.y += 20;
          break;
        default:
          console.log(e.keyCode);
      }
    };

    const stereogramOptions = {
      width,
      height,
      mu: (1/3),
      dpi: 72
    };

    let baseSame = AutoStereogram.generatePixelRelations(
      function() {
        return 0;
      },
      stereogramOptions
    );

    let paddle = new Paddle({
      width: 35,
      height: 90,
      x: 150,
      y: 50,
    });

    let ball = new Ball({
      radius: 30,
      x: 350,
      y: 180,
      xVel: 0,
      yVel: 0,
    });

    var interval = setInterval(function() {
      t += 1;

      ball.pos.y = 180 + Math.cos(t * 0.1) * 100;

      var newSame = AutoStereogram.mapSurfaceRelations(
        baseSame,
        function(x, y) {
          return ball.shape(x, y) || paddle.shape(x, y);
        },
        {
          width: width,
          height: height,
          mu: (1/3),
          dpi: 72,
          depth: 0.7,
        }
      );

      var pixels = AutoStereogram.drawSame(newSame, { width: width, height: height })
      drawPixels(ctx, pixels, colors, width, height);
  }, 1000);

  </script>
</body>
</html>
