<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pong</title>

</head>
<body>
  <canvas id="pong-canvas" style="border: 1px solid black; margin: 200px auto; display: block"></canvas>

  <script src="AutoStereogram.js"></script>
  <script src="pong.js"></script>

  <script>
    var canvas = document.getElementById("pong-canvas");
    var ctx = canvas.getContext("2d");
    width = 800;
    height = 400;
    canvas.width = width;
    canvas.height = height;
    var game = new Pong(ctx, width, height);


    // key('w', console.log.bind('w'));
    // key('s', console.log.bind('s'));

    // setInterval(function () {
    //   game.step();
    //   game.render()
    // }, 20);

    imgMap = []
    depthMap = [];
    for (var y = 0; y < height; y++) {
      depthMap[y] = [];
      imgMap[y] = [];
      for (var x = 0; x < width; x++) {
        if (x > 330 && x < 450 && y > 150 && y < 200) {
          depthMap[y][x] = 1;
          imgMap[y][x] = 1;
        } else if (x > 320 && x < 410 && y > 190 && y < 250) {
          depthMap[y][x] = 0.5;
          imgMap[y][x] = 2;
        } else if (x > 250 && x < 500 && y > 160 && y < 300) {
          depthMap[y][x] = 0.2;
          imgMap[y][x] = 3;
        } else {
          depthMap[y][x] = 0;
          imgMap[y][x] = 0;
        }
      }
    }

    var colors = [
      [71, 113, 134],
      [110, 146, 161],
      [17, 60, 81],
      [3, 37, 54],
      [54, 130, 127],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
    ];

    var canvasData = ctx.getImageData(0, 0, width, height);

    // That's how you define the value of a pixel //
    function drawPixel (x, y, r, g, b, a) {
        var index = (x + y * width) * 4;

        canvasData.data[index + 0] = r;
        canvasData.data[index + 1] = g;
        canvasData.data[index + 2] = b;
        canvasData.data[index + 3] = a;
    }

    function updateCanvas() {
        ctx.putImageData(canvasData, 0, 0);
    }

    var interval = setInterval(function() {
      pixels = AutoStereogram.generatePixels(
        depthMap,
        {
          width: width,
          height: height,
          mu: (1/3),
          dpi: 72,
        }
      );

      for(var y = 0; y < height; y++) {
        for(var x = 0; x < width; x++) {
          color = colors[pixels[y][x]];
          drawPixel(x, y, color[0], color[1], color[2], 255);
        }
      }

      updateCanvas();
  }, 33);

  // setTimeout(function() {
  //   clearInterval(interval);
  // }, 0);

  </script>
</body>
</html>
