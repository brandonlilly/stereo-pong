<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pong</title>

</head>
<body>
  <canvas id="pong-canvas" style="border: 1px solid black; margin: 200px auto; display: block"></canvas>

  <script src="AutoStereogram.js"></script>
  <script src="pong.js"></script>

  <script>
    var canvas = document.getElementById("pong-canvas");
    var ctx = canvas.getContext("2d");
    width = 800;
    height = 400;
    canvas.width = width;
    canvas.height = height;
    var game = new Pong(ctx, width, height);

    depthMap = [];
    for (var y = 0; y < height; y++) {
      depthMap[y] = [];
      for (var x = 0; x < width; x++) {
        depthMap[y][x] = 0;
      }
    }

    var colors = [
      [71, 113, 134],
      [110, 146, 161],
      [17, 60, 81],
      [3, 37, 54],
      [54, 130, 127],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
      [Math.floor(Math.random() * 256), Math.floor(Math.random() * 256), Math.floor(Math.random() * 256)],
    ];

    var canvasData = ctx.getImageData(0, 0, width, height);

    // That's how you define the value of a pixel //
    function drawPixel (x, y, r, g, b, a) {
        var index = (x + y * width) * 4;

        canvasData.data[index + 0] = r;
        canvasData.data[index + 1] = g;
        canvasData.data[index + 2] = b;
        canvasData.data[index + 3] = a;
    }

    function updateCanvas() {
        ctx.putImageData(canvasData, 0, 0);
    }



    var t = 0;
    var mapFunction = function(x, y) {
      var offset = Math.cos(t * 0.2) * 100;
      if (x > 370 && x < 430 && y > 150 + offset && y < 200 + offset) {
        return true;
      }
      return false;
    };

    var square = function(w, h) {
      // var w = 60;
      // var h = 60;
      var xPos = 350;
      var yPos = 180 + Math.cos(t * 0.1) * 100;
      return function(x, y) {
        return (x < xPos + w/2 && x > xPos - w/2 && y < yPos + h/2 && y > yPos - h/2);
      };
    }

    var circle = function(r, xPos, yPos) {
      // var r = 20;
      var xPos = 350;
      var yPos = 180 + Math.cos(t * 0.1) * 100;
      return function(x, y) {
        return (Math.sqrt(Math.pow(x - xPos, 2) + Math.pow(y - yPos, 2)) < r);
      };
    }

    var basePixels = AutoStereogram.generatePixels(
      depthMap,
      {
        width: width,
        height: height,
        mu: (1/3),
        dpi: 72,
      }
    );

    var interval = setInterval(function() {
      t += 1;

      // lastRow = basePixels.pop(5);
      // basePixels.unshift(lastRow);

      // if (t % 10 === 0) {
        basePixels = AutoStereogram.generatePixels(
          depthMap,
          {
            width: width,
            height: height,
            mu: (1/3),
            dpi: 72,
          }
        );
      // }

      var pixels = AutoStereogram.drawSurface(
        basePixels,
        circle(25),
        {
          width: width,
          height: height,
          mu: (1/3),
          dpi: 72,
          depth: 1,
        }
      );


      for(var y = 0; y < height; y++) {
        for(var x = 0; x < width; x++) {
          color = colors[pixels[y][x]];
          drawPixel(x, y, color[0], color[1], color[2], 255);
        }
      }

      updateCanvas();
  }, 50);

  // setTimeout(function() {
  //   clearInterval(interval);
  // }, 0);

  </script>
</body>
</html>
